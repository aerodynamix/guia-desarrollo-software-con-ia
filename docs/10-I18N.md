# 10 - Internacionalizacion (i18n)

> Si el proyecto necesita multiples idiomas, implementarlo desde el inicio.
> Agregarlo despues es costoso y propenso a errores.

---

## Cuando Aplicar i18n

```
SI:
  - SaaS con clientes en multiples paises
  - Ecommerce internacional
  - App movil publicada globalmente
  - El cliente lo solicita explicitamente

NO (no agregarlo "por si acaso"):
  - Landing page para mercado local
  - Sistema interno de empresa
  - Dashboard para un solo equipo
  - POS local
```

---

## Principios

1. **Nunca hardcodear textos en componentes.** Usar claves de traduccion.
2. **Separar textos en archivos JSON por idioma.**
3. **Formatear fechas, numeros y moneda segun locale.**
4. **Disenar UI flexible.** Los textos en aleman son 30-40% mas largos que en ingles.

---

## Estrategia Angular (Recomendada)

### Opcion A: ngx-translate / Transloco (Dinámico)
Recomendado para la mayoría de apps que necesitan cambiar idioma sin recargar.

**Estructura:**
```
src/
  assets/
    i18n/
      es.json        # Espanol (idioma base)
      en.json        # Ingles
```

**Uso en Template (Pipe):**
```html
<h1>{{ 'HOME.TITLE' | translate }}</h1>
<button>{{ 'BUTTONS.SAVE' | translate }}</button>
<p>{{ 'PRODUCTS.PRICE' | translate: { value: product.price } }}</p>
```

**Uso en Código (Service):**
```typescript
constructor(private translate: TranslateService) {
  this.translate.setDefaultLang('es');
  this.translate.use('en');
}

showMessage() {
  this.translate.get('ERRORS.REQUIRED').subscribe((res: string) => {
    this.snackBar.open(res);
  });
}
```

### Opcion B: @angular/localize (Nativo)
Recomendado para apps de alto rendimiento donde el SEO es crítico. Genera un bundle por idioma.

**Uso en Template:**
```html
<h1 i18n="@@homeTitle">Bienvenido</h1>
<p i18n="@@productsCount">Tienes {count, plural, =0 {ningún producto} =1 {un producto} other {# productos}}</p>
```

---

## Estructura de JSON (ngx-translate)

```json
// es.json
{
  "COMMON": {
    "SAVE": "Guardar",
    "CANCEL": "Cancelar",
    "LOADING": "Cargando..."
  },
  "AUTH": {
    "LOGIN_TITLE": "Iniciar sesión",
    "EMAIL_LABEL": "Correo electrónico"
  },
  "ERRORS": {
    "REQUIRED": "Este campo es obligatorio",
    "SERVER_ERROR": "Error del servidor. Intente nuevamente."
  }
}
```

**Regla de claves:** Usar estructura jerarquica por modulo (UPPER_SNAKE_CASE es común pero opcional).

---

## Formateo de Datos por Locale

Angular provee `DatePipe`, `CurrencyPipe`, `DecimalPipe` que usan el locale activo.

### Fechas
```html
<!-- es-CL: 15 de enero de 2026 -->
<p>{{ today | date:'longDate' }}</p>
```

### Moneda
```html
<!-- es-CL: $29.990 -->
<p>{{ price | currency:'CLP':'symbol-narrow':'1.0-0' }}</p>
```

---

## SEO Multiidioma (SSR)

Si usas Angular Universal (SSR), debes configurar las rutas para cada idioma.

```html
<!-- Indicar idiomas alternativos en index.html -->
<link rel="alternate" hreflang="es" href="https://mitienda.cl/es/productos">
<link rel="alternate" hreflang="en" href="https://mitienda.cl/en/products">
<link rel="alternate" hreflang="x-default" href="https://mitienda.cl/">
```

---

## Backend (NestJS)

Usar `nestjs-i18n` para responder mensajes de error en el idioma del usuario.

```typescript
// main.ts
app.useGlobalPipes(
  new ValidationPipe({
    exceptionFactory: (errors) => new I18nValidationException(errors),
  }),
);

// En el controlador, el decorador @I18n() inyecta el contexto
@Get()
async getHello(@I18n() i18n: I18nContext) {
  return await i18n.t('hello.message');
}
```
